# Настройка обновлений для Capacitor приложения

## Быстрая настройка

### Вариант 1: Автоматическая настройка (рекомендуется)

1. **Запустите сервер Flask:**
   ```bash
   python app.py
   ```

2. **В другом терминале выполните:**
   ```bash
   npm run cap:setup-server
   ```

   Скрипт автоматически определит IP адрес вашего компьютера и настроит `capacitor.config.json`.

3. **Синхронизируйте конфигурацию:**
   ```bash
   npx cap sync
   ```

4. **Пересоберите APK:**
   ```bash
   npm run android:build
   ```

### Вариант 2: Ручная настройка

1. **Узнайте IP адрес вашего компьютера:**
   - Windows: `ipconfig` (ищите IPv4 адрес)
   - Linux/Mac: `ifconfig` или `ip addr`
   - Или откройте в браузере: `http://localhost:5000/api/server-info`

2. **Откройте `capacitor.config.json` и измените:**
   ```json
   "server": {
     "url": "http://ВАШ_IP:5000",
     "androidScheme": "https",
     "cleartext": true
   }
   ```
   
   Замените `ВАШ_IP` на ваш IP адрес (например, `192.168.1.100`)

3. **Синхронизируйте и пересоберите:**
   ```bash
   npx cap sync
   npm run android:build
   ```

## Проверка работы

После настройки:

1. Установите APK на устройство
2. Убедитесь, что устройство и компьютер в одной Wi-Fi сети
3. Запустите сервер Flask на компьютере
4. В приложении нажмите: **Меню пользователя → Проверить обновления → Обновить сейчас**

Если всё настроено правильно:
- Приложение перезагрузится
- Загрузится новый контент с сервера
- Вы увидите изменения (например, зеленый header в мобильной версии)

## Важные замечания

1. **IP адрес может меняться** при переподключении к Wi-Fi. Если обновления перестали работать:
   - Проверьте IP адрес: `http://localhost:5000/api/server-info`
   - Обновите `capacitor.config.json`
   - Выполните `npx cap sync` и пересоберите APK

2. **Сервер должен быть запущен** для работы обновлений. Если сервер выключен, приложение не загрузится.

3. **Устройство и компьютер** должны быть в одной Wi-Fi сети.

4. **Порт 5000** должен быть открыт в файрволе.

## Решение проблем

### Обновления не работают

1. Проверьте, что сервер запущен: `http://localhost:5000`
2. Проверьте IP адрес в `capacitor.config.json`
3. Убедитесь, что устройство в той же сети
4. Проверьте, что выполнили `npx cap sync` после изменения конфига

### Приложение не загружается

1. Проверьте, что сервер доступен с устройства
2. Откройте в браузере на устройстве: `http://ВАШ_IP:5000`
3. Если не открывается - проверьте файрвол и сеть

### Нужен офлайн режим

Если нужна работа без сервера, уберите `server.url` из `capacitor.config.json`:
```json
"server": {
  "androidScheme": "https"
}
```

Но тогда обновления будут работать только через пересборку APK.

