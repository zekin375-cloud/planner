# Настройка клиент-серверной архитектуры

## Как это работает

- **Компьютер** работает как сервер (Flask)
- **Телефон** подключается к серверу через API запросы
- Все данные хранятся на компьютере в базе данных

## Быстрый старт

### 1. Установите зависимости

```bash
pip install -r requirements.txt
```

### 2. Запустите сервер на компьютере

**Windows:**
```cmd
start-server.bat
```

**Linux/Mac:**
```bash
chmod +x start-server.sh
./start-server.sh
```

Скрипт покажет IP адрес вашего компьютера, например: `192.168.1.100`

### 3. Настройте приложение на телефоне

После установки APK на телефон:

1. Откройте приложение
2. В настройках (или при первом запуске) введите IP адрес сервера:
   ```
   http://192.168.1.100:5000
   ```
   (замените на ваш IP из шага 2)

3. Приложение подключится к серверу

## Настройка IP адреса в приложении

### Вариант 1: Через настройки приложения

Добавьте экран настроек в приложение для ввода IP адреса сервера.

### Вариант 2: Через Capacitor конфиг

Измените `capacitor.config.json`:

```json
{
  "server": {
    "url": "http://ВАШ_IP:5000"
  }
}
```

Затем пересоберите APK.

### Вариант 3: Автоматическое определение (для разработки)

Можно добавить QR-код на страницу сервера, который содержит IP адрес.
При сканировании приложение автоматически настроится.

## Проверка подключения

1. Убедитесь, что компьютер и телефон в одной Wi-Fi сети
2. Проверьте, что файрвол не блокирует порт 5000
3. Откройте в браузере телефона: `http://ВАШ_IP:5000`
   - Должна открыться страница приложения

## Решение проблем

### Телефон не подключается

1. **Проверьте IP адрес:**
   ```bash
   python get-local-ip.py
   ```

2. **Проверьте файрвол:**
   - Windows: Разрешите Python через файрвол
   - Linux: `sudo ufw allow 5000`

3. **Проверьте сеть:**
   - Компьютер и телефон должны быть в одной Wi-Fi сети
   - Не используйте мобильный интернет на телефоне

### CORS ошибки

Если видите ошибки CORS, убедитесь что в `app.py` добавлен:
```python
from flask_cors import CORS
CORS(app, resources={r"/api/*": {"origins": "*"}})
```

## Безопасность

⚠️ **Важно:** Текущая настройка позволяет подключение с любого устройства в сети.

Для продакшена:
1. Добавьте аутентификацию
2. Ограничьте CORS только нужными доменами
3. Используйте HTTPS

## Структура

```
Компьютер (Сервер):
├── app.py              # Flask сервер
├── database.py         # База данных SQLite
├── planner.db          # Файл базы данных
└── start-server.bat    # Запуск сервера

Телефон (Клиент):
├── APK приложение      # Capacitor приложение
├── config.js           # Конфигурация API
└── api.js              # Обертка для API запросов
```

## API Endpoints

Все API запросы идут на: `http://ВАШ_IP:5000/api/...`

- `GET /api/projects` - список проектов
- `POST /api/projects` - создать проект
- `GET /api/projects/{id}/tasks` - задачи проекта
- `POST /api/projects/{id}/tasks` - создать задачу
- И т.д.


