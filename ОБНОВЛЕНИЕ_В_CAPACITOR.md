# Обновление приложения в Capacitor

## Проблема

В Capacitor приложениях контент по умолчанию **встроен в APK файл** (находится в `android/app/src/main/assets/public/`). 

Когда вы делаете `window.location.reload()`, WebView просто перезагружает страницу из **встроенных файлов в APK**, а не с сервера. Поэтому обновления не применяются.

## Решение

Для обновления контента **без пересборки APK** нужно настроить Capacitor для загрузки контента с сервера.

### Шаг 1: Настройте capacitor.config.json

Откройте файл `capacitor.config.json` и добавьте настройку `server.url`:

```json
{
  "appId": "com.planner.app",
  "appName": "Планировщик",
  "webDir": "dist",
  "server": {
    "url": "http://ВАШ_IP_АДРЕС:5000",
    "androidScheme": "https"
  },
  "android": {
    "allowMixedContent": true,
    "captureInput": true,
    "webContentsDebuggingEnabled": true
  }
}
```

**Важно:** 
- Замените `ВАШ_IP_АДРЕС` на IP адрес вашего компьютера в локальной сети
- Убедитесь, что порт 5000 открыт и доступен
- Устройство и компьютер должны быть в одной Wi-Fi сети

### Шаг 2: Синхронизируйте конфигурацию

Выполните команду:

```bash
npx cap sync
```

### Шаг 3: Пересоберите APK

После изменения конфигурации нужно пересобрать APK:

```bash
npm run android:build
```

Или в Android Studio соберите новый APK.

### Шаг 4: Проверьте обновления

Теперь при нажатии "Проверить обновления" → "Обновить сейчас":
1. Приложение очистит кэш
2. Перезагрузит WebView
3. Загрузит новый контент с сервера

## Альтернативное решение (для разработки)

Если вы хотите обновлять контент во время разработки без пересборки APK каждый раз, можно использовать **live reload**:

1. Запустите сервер Flask на компьютере
2. Настройте `server.url` в `capacitor.config.json` на адрес сервера
3. При каждом изменении файлов просто перезагрузите приложение

## Важные замечания

1. **Безопасность**: При использовании `server.url` контент загружается по сети. Убедитесь, что:
   - Используется HTTPS в продакшене
   - Сервер доступен только в доверенной сети
   - Настроена правильная аутентификация

2. **Офлайн режим**: Если сервер недоступен, приложение не загрузится. Для офлайн работы нужно:
   - Либо встроить контент в APK (как сейчас)
   - Либо использовать Service Worker для кэширования

3. **Производительность**: Загрузка с сервера медленнее, чем из встроенных файлов. Учитывайте это при разработке.

## Текущая ситуация

В вашем проекте контент **встроен в APK**. Это значит:
- ✅ Приложение работает офлайн
- ✅ Быстрая загрузка
- ❌ Обновление требует пересборки APK

Для обновления без пересборки нужно настроить `server.url` как описано выше.

